angular.module("starter.controllers",[]).controller("AppCtrl",function(e,n,t,a,o,s,r){e.loginData={},e.profileData={ambition:2,incomes:[],expenses:[]},e.goToPage=function(e){r.go(e)},n.fromTemplateUrl("templates/profile.html",{scope:e}).then(function(n){e.modal=n}),e.closeLogin=function(){e.modal.hide()},e.login=function(){e.modal.show()},e.logout=function(){t(function(){a.user.loggedIn=!1},400),o.setObject("user",a.user)},e.doLogin=function(){a.user.loggedIn=!0,o.setObject("user",a.user),t(function(){e.closeLogin()},1e3)},e.removeUser=function(){a.user={},o.setObject("user",a.user)},void 0===a.user.profile.ambition&&t(e.login,300),e.showIncome=function(){e.income={};var n=s.show({template:'<label class="item"><input type="text" placeholder="Navn" ng-model="income.name"></label><label class="item"><input type="tel" placeholder="Inntekt" ng-model="income.value"></label>',title:"Legg til inntekt",subTitle:"Kun faste inntekter",scope:e,buttons:[{text:"Avbryt"},{text:"<b>Lagre</b>",type:"button-positive",onTap:function(n){return e.income.name&&e.income.value?e.income:void n.preventDefault()}}]});n.then(function(n){var t=n.name,a=parseInt(n.value);isNaN(a)?console.log("NaN"):(n.name=t,n.value=a,e.profileData.incomes.push(n))})},e.showExpense=function(){e.expense={};var n=s.show({template:'<label class="item"><input type="text" placeholder="Navn" ng-model="expense.name"></label><label class="item"><input type="tel" placeholder="Utgift" ng-model="expense.value"></label>',title:"Legg til utgift",subTitle:"Kun faste utgifter",scope:e,buttons:[{text:"Avbryt"},{text:"<b>Lagre</b>",type:"button-positive",onTap:function(n){return e.expense.name&&e.expense.value?e.expense:void n.preventDefault()}}]});n.then(function(n){var t=n.name,a=parseInt(n.value);isNaN(a)?console.log("NaN"):(n.name=t,n.value=a,e.profileData.expenses.push(n))})},e.saveProfile=function(){a.user.profile=e.profileData,o.setObject("user",a.user),e.modal.hide()}}).controller("OverviewCtrl",function(e,n){e.overview={budgets:[],usedPerBudget:[],totalBudget:0,totalSave:0,used:0,saved:0,total:0,difference:0,lastTransaction:{}},e.calcTotal=function(){e.overview={budgets:[],usedPerBudget:[],totalBudget:0,totalSave:0,used:0,saved:0,total:0,difference:0,lastTransaction:{}};for(var t=0;t<n.user.accounts.length;t++)e.overview.total+=parseInt(n.user.accounts[t].balance);for(t=0;t<n.user.budgets.length;t++)e.overview.budgets.push(n.user.budgets[t].name),e.overview.usedPerBudget.push(n.user.budgets[t].used),e.overview.totalBudget+=n.user.budgets[t].amount,e.overview.used+=n.user.budgets[t].used;for(t=0;t<n.user.savegoals.length;t++)e.overview.totalSave+=n.user.savegoals[t].amount,e.overview.saved+=n.user.savegoals[t].saved;for(t=0;t<n.user.transactions.length;t++)"Inngående"===n.user.transactions[t].type?e.overview.difference+=n.user.transactions[t].amount:e.overview.difference-=n.user.transactions[t].amount;n.user.transactions.length>0&&(e.overview.lastTransaction=n.user.transactions[n.user.transactions.length-1]),e.smallDatachart.labels=e.overview.budgets,e.smallDatachart.datasets[0].data=e.overview.usedPerBudget},e.datachart={labels:["Uke 1","Uke 2","Uke 3","Uke 4"],datasets:[{fillColor:"rgba(255, 255, 255, 0.3)",strokeColor:"rgba(52, 152, 219,0)",pointColor:"rgba(255,255,255,1)",pointStrokeColor:"rgba(255, 255, 255,0)",data:[99,299,532,400]},{fillColor:"rgba(255, 255, 255, 0.1)",strokeColor:"rgba(52, 152, 219,0)",pointColor:"rgba(255, 255, 255,0)",pointStrokeColor:"rgba(255, 255, 255, 0.2)",data:[0,899,200,100]}]},e.options={scaleFontColor:"rgba(255,255,255,0.8",scaleLineColor:"rgba(255,255,255,0.2)",scaleLineWidth:1},e.smallDatachart={labels:[],datasets:[{fillColor:"rgba(52, 152, 219,1.0)",strokeColor:"rgba(52, 152, 219,0)",pointColor:"rgba(151,187,205,0)",pointStrokeColor:"#e67e22",data:[]}]},e.smallOptions={},e.doRefresh=function(){e.calcTotal(),e.$broadcast("scroll.refreshComplete")},e.calcTotal()}).controller("BudgetCtrl",function(e,n,t,a){e.newBudget={},e.newBudget.type="week",t.fromTemplateUrl("templates/newBudget.html",{scope:e,animation:"slide-in-up"}).then(function(n){e.modal=n}),e.openModal=function(){e.modal.show()},e.closeModal=function(){e.modal.hide()},e.$on("$destroy",function(){e.modal.remove()}),e.$on("modal.hidden",function(){}),e.$on("modal.removed",function(){}),e.addBudget=function(){"week"===e.newBudget.type?e.newBudget.amount=parseInt(e.newBudget.amount):e.newBudget.amount=parseInt(e.newBudget.amount)/4,e.newBudget.used=0,n.user.budgets.push(e.newBudget),a.setObject("user",n.user),e.newBudget={},e.newBudget.type="week",e.modal.hide(),e.calcTotal()},e.totalBudget=0,e.totalUsed=0,e.calcTotal=function(){e.totalBudget=0,e.totalUsed=0;for(var t=0;t<n.user.budgets.length;t++)e.totalBudget+=parseInt(n.user.budgets[t].amount),e.totalUsed+=parseInt(n.user.budgets[t].used)},e.doRefresh=function(){e.calcTotal(),e.$broadcast("scroll.refreshComplete")},e.calcTotal()}).controller("BudgetDetailsCtrl",function(e,n,t,a,o){for(var s=n.user.budgets,r=0;r<s.length;r++)s[r].name===o.id&&(e.budget=s[r]);e.transactions=[];var u=n.user.transactions;for(r=0;r<u.length;r++)u[r].budget.name===o.id&&e.transactions.push(u[r])}).controller("SavingsCtrl",function(e,n,t,a){e.newSaving={},e.totalGoal=0,e.totalSaved=0,e.calcTotal=function(){e.totalGoal=0,e.totalSaved=0;for(var t=0;t<n.user.savegoals.length;t++)e.totalGoal+=parseInt(n.user.savegoals[t].amount),e.totalSaved+=parseInt(n.user.savegoals[t].saved)},e.autoSave="show",t.fromTemplateUrl("templates/newSave.html",{scope:e,animation:"slide-in-up"}).then(function(n){e.modal=n}),e.openModal=function(){e.modal.show();var t=n.user.settings.defaultAccount;e.newSaving.account=n.user.accounts[t]},e.closeModal=function(){e.modal.hide()},e.addSaving=function(){null===n.user.counter&&n.user.counter.push(0),n.user.counter++,e.newSaving.id=n.user.counter,e.newSaving.created=new Date,e.newSaving.amount=parseInt(e.newSaving.amount),e.newSaving.saved=e.newSaving.amount/(Math.floor(2*Math.random())+1.5),n.user.savegoals.push(e.newSaving),a.setObject("user",n.user),e.newSaving={},e.modal.hide(),e.calcTotal()},e.$on("$destroy",function(){e.modal.remove()}),e.$on("modal.hidden",function(){}),e.$on("modal.removed",function(){}),angular.element(document).ready(function(){e.calcTotal()})}).controller("SaveDetailsCtrl",function(e,n,t,a,o){for(var s=n.user.savegoals,r,u=0;u<s.length;u++)s[u].id===o.saveId&&(r=s[u],e.currentDate=new Date,e.name=r.name,e.description=r.description,e.genre=r.genre,e.deadline=r.deadline,e.amount=r.amount,e.saved=r.saved)}).controller("SettingsCtrl",function(e,n,t,a){e.settings=t.user.settings,e.$watch("settings",function(e){t.user.settings=e,a.setObject("user",t.user)},!0)}).controller("AccountsCtrl",function(e,n,t,a){e.newAccount={},e.listCanSwipe=!0,n.fromTemplateUrl("templates/newAccount.html",{scope:e,animation:"slide-in-up"}).then(function(n){e.modal=n}),e.openModal=function(){e.modal.show()},e.closeModal=function(){e.modal.hide()},e.addAccount=function(){e.newAccount.balance=parseInt(e.newAccount.balance),t.user.accounts.push(e.newAccount),a.setObject("user",t.user),e.newAccount={},e.modal.hide()},e.deleteAccount=function(e){t.user.accounts.splice(e,1),a.setObject("user",t.user)},e.$on("$destroy",function(){e.modal.remove()}),e.$on("modal.hidden",function(){}),e.$on("modal.removed",function(){})}).controller("ContactsCtrl",function(e,n,t,a,o){for(var s=n.user.contacts,r,u=0;u<s.length;u++)s[u].id===o.saveId&&(r=s[u],e.name=r.name,e.description=r.description,e.genre=r.genre,e.deadline=r.deadline,e.amount=r.amount,e.saved=r.saved)}).controller("EventsCtrl",function(e,n,t,a){e.newSaving={},e.totalGoal=0,e.totalSaved=0,e.calcTotal=function(){e.totalGoal=0,e.totalSaved=0;for(var t=0;t<n.user.savegoals.length;t++)e.totalGoal+=parseInt(n.user.savegoals[t].amount),e.totalSaved+=parseInt(n.user.savegoals[t].saved)},e.autoSave="show",t.fromTemplateUrl("templates/newEvent.html",{scope:e,animation:"slide-in-up"}).then(function(n){e.modal=n}),e.openModal=function(){e.modal.show();var t=n.user.settings.defaultAccount;e.newSaving.account=n.user.accounts[t]},e.closeModal=function(){e.modal.hide()},e.addSaving=function(){null===n.user.counter&&n.user.counter.push(0),n.user.counter++,e.newSaving.id=n.user.counter,e.newSaving.created=new Date,e.newSaving.amount=parseInt(e.newSaving.amount),e.newSaving.saved=e.newSaving.amount/(Math.floor(2*Math.random())+1.5),n.user.savegoals.push(e.newSaving),a.setObject("user",n.user),e.newSaving={},e.modal.hide(),e.calcTotal()},e.$on("$destroy",function(){e.modal.remove()}),e.$on("modal.hidden",function(){}),e.$on("modal.removed",function(){}),angular.element(document).ready(function(){e.calcTotal()})}).controller("EventDetailsCtrl",function(e,n,t,a,o){for(var s=n.user.events,r=0;r<s.length;r++)s[r].id===o.eventId&&(e.event=s[r])}).controller("TransactionsCtrl",function(e,n,t,a){e.newTransaction={},n.fromTemplateUrl("templates/newTransaction.html",{scope:e,animation:"slide-in-up"}).then(function(n){e.modal=n}),e.openModal=function(){e.modal.show();var n=t.user.settings.defaultAccount;e.newTransaction.account=t.user.accounts[n]},e.closeModal=function(){e.modal.hide()},e.addTransaction=function(){e.newAccount.balance=parseInt(e.newAccount.balance),t.user.accounts.push(e.newAccount),a.setObject("user",t.user),e.newAccount={},e.modal.hide()},e.$on("$destroy",function(){e.modal.remove()}),e.$on("modal.hidden",function(){}),e.$on("modal.removed",function(){}),e.addTransaction=function(){var n,o;t.user.accounts.some(function(t,a){return t.name===e.newTransaction.account.name?(n=a,!0):void 0}),t.user.budgets.some(function(n,t){return n.name===e.newTransaction.budget.name?(o=t,!0):void 0}),e.newTransaction.amount=parseInt(e.newTransaction.amount),e.newTransaction.date=new Date,t.user.transactions.push(e.newTransaction),t.user.accounts[n].balance-=e.newTransaction.amount,t.user.budgets[o].used+=e.newTransaction.amount,a.setObject("user",t.user),e.newTransaction={},e.modal.hide()}}).controller("LoansCtrl",function(e,n,t,a){e.newLoan={},e.totalLoan=0,e.totalPayed=0,e.calcTotal=function(){e.totalLoan=0,e.totalPayed=0;for(var t=0;t<n.user.loans.length;t++)e.totalLoan+=parseInt(n.user.loans[t].amount),e.totalPayed+=parseInt(n.user.loans[t].saved)},e.autoSave="show",t.fromTemplateUrl("templates/newLoan.html",{scope:e,animation:"slide-in-up"}).then(function(n){e.modal=n}),e.openModal=function(){e.modal.show();var t=n.user.settings.defaultAccount;e.newLoan.account=n.user.accounts[t]},e.closeModal=function(){e.modal.hide()},e.addLoan=function(){e.newLoan.amount=parseInt(e.newLoan.amount),e.newLoan.payed=e.newLoan.amount/(Math.floor(2*Math.random())+1.5),n.user.loans.push(e.newLoan),a.setObject("user",n.user),e.newLoan={},e.modal.hide(),e.calcTotal()},e.$on("$destroy",function(){e.modal.remove()}),e.$on("modal.hidden",function(){}),e.$on("modal.removed",function(){}),angular.element(document).ready(function(){e.calcTotal()})}).controller("PaymentsCtrl",function(e,n,t,a){e.newTransaction={},n.fromTemplateUrl("templates/newPayment.html",{scope:e,animation:"slide-in-up"}).then(function(n){e.modal=n}),e.openModal=function(n){n=n||null,e.newTransaction.id="",e.newTransaction.name="",e.newTransaction.to="",e.newTransaction.amount="";var a=t.user.settings.defaultAccount;if(e.newTransaction.account=t.user.accounts[a],n){e.newTransaction.id=n.id,e.newTransaction.name=n.name,e.newTransaction.amount=n.amount;for(var o=t.user.contacts,s=!1,r=0;r<o.length;r++)o[r].name===n.from?(e.newTransaction.to=o[r],s=!0):s||(e.newTransaction.to="")}e.modal.show()},e.closeModal=function(){e.modal.hide()},e.addTransaction=function(){e.newAccount.balance=parseInt(e.newAccount.balance),t.user.accounts.push(e.newAccount),a.setObject("user",t.user),e.newAccount={},e.modal.hide()},e.$on("$destroy",function(){e.modal.remove()}),e.$on("modal.hidden",function(){}),e.$on("modal.removed",function(){}),e.addTransaction=function(){var n,o;t.user.accounts.some(function(t,a){return t.name===e.newTransaction.account.name?(n=a,!0):void 0}),t.user.budgets.some(function(n,t){return n.name===e.newTransaction.budget.name?(o=t,!0):void 0}),e.newTransaction.amount=parseInt(e.newTransaction.amount),e.newTransaction.date=new Date,e.newTransaction.type="Utgående",t.user.transactions.push(e.newTransaction),t.user.accounts[n].balance-=e.newTransaction.amount,t.user.budgets[o].used+=e.newTransaction.amount,a.setObject("user",t.user);for(var s=t.user.payments,r=0;r<s.length;r++)s[r].id===e.newTransaction.id&&s.splice(r,1);e.newTransaction={},e.modal.hide()}});